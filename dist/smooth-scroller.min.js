class SmoothScroller{constructor(t={}){this.scrollElement=this._resolveElement(t.element||"#scrollSmooth"),this.wrapperElement=null,this.currentScroll=window.scrollY,this.targetScroll=window.scrollY,this.lastTime=performance.now(),this.isRunning=!1,this.animationFrameId=null,this.resizeObserver=null,this.isTouchDevice=this._isTouchDevice(),this.prefersReducedMotion=this._prefersReducedMotion(),this.animations=[],this.isAnimating=!1,this.currentAnimation=null,this.config={smoothness:this._clamp(t.smoothness??.95,.5,.99),minMovement:t.minMovement??.5,maxDeltaTime:t.maxDeltaTime??2,debug:t.debug??!1,scrollToDuration:t.scrollToDuration??1e3,scrollToEasing:t.scrollToEasing??"easeInOutCubic",autoScrollOffset:t.autoScrollOffset??0,useNativeForTouch:t.useNativeForTouch??!0,respectReducedMotion:t.respectReducedMotion??!0},this.easings={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeOutBack:t=>{const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)},easeOutElastic:t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}},this._bindMethods(),this._shouldUseSmooth()?this.init():(this._setupFallback(),this._log("Using native scrolling due to device or user preference"))}_bindMethods(){this.updateScroll=this.updateScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleScroll=this.handleScroll.bind(this),this.animate=this.animate.bind(this)}_shouldUseSmooth(){return(!this.prefersReducedMotion||!this.config.respectReducedMotion)&&(!this.isTouchDevice||!this.config.useNativeForTouch)}_isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}_prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}_clamp(t,e,i){return Math.min(Math.max(t,e),i)}_setupFallback(){this.scrollElement&&(this.scrollElement.style.position="",this.scrollElement.style.top="",this.scrollElement.style.left="",this.scrollElement.style.width="",this.scrollElement.style.transform="")}_resolveElement(t){return"string"==typeof t?document.querySelector(t):t}_log(t,e){this.config.debug&&(void 0!==e?console.log(`SmoothScroller: ${t}`,e):console.log(`SmoothScroller: ${t}`))}setupScrollStructure(){if(!this.scrollElement)return this._log("No scroll element found - abort setup"),0;const t=this.scrollElement.scrollHeight;return document.getElementById("smooth-scroll-wrapper")?(this.wrapperElement=document.getElementById("smooth-scroll-wrapper"),this.wrapperElement.style.height=t+"px"):(this.wrapperElement=document.createElement("div"),this.wrapperElement.id="smooth-scroll-wrapper",this.wrapperElement.style.cssText=`\n                height: ${t}px;\n                position: relative;\n                width: 100%;\n                pointer-events: none;\n            `,this.scrollElement.parentNode.insertBefore(this.wrapperElement,this.scrollElement),this.wrapperElement.appendChild(this.scrollElement)),this.scrollElement.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            z-index: 1;\n            pointer-events: auto;\n            will-change: transform;\n        ",this.scrollElement.setAttribute("aria-live","polite"),document.body.style.overflow="auto",document.body.style.margin="0",document.body.style.padding="0",this._log(`Content height set to ${t}px`),t}handleScroll(){this.isAnimating||(this.targetScroll=window.scrollY)}updateScroll(){if(!this.isRunning)return;const t=performance.now(),e=Math.min((t-this.lastTime)/16.67,this.config.maxDeltaTime);if(this.lastTime=t,this.isAnimating&&this.currentAnimation)this.animate();else{const t=this.targetScroll-this.currentScroll;Math.abs(t)<this.config.minMovement?this.currentScroll=this.targetScroll:this.currentScroll+=t*(1-this.config.smoothness)*e}this.scrollElement.style.transform=`translate3d(0, -${this.currentScroll}px, 0)`,this.animationFrameId=requestAnimationFrame(this.updateScroll)}animate(){const t=this.currentAnimation;if(!t)return;const e=performance.now()-t.startTime,i=Math.min(e/t.duration,1),s=(this.easings[t.easing]||this.easings.easeInOutCubic)(i);if(this.currentScroll=t.startPosition+(t.targetPosition-t.startPosition)*s,i<1)window.scrollTo(0,this.currentScroll);else{if(window.scrollTo(0,t.targetPosition),this.currentScroll=t.targetPosition,this.targetScroll=t.targetPosition,this.isAnimating=!1,this.currentAnimation=null,"function"==typeof t.onComplete&&t.onComplete(),this.animations.length>0){const t=this.animations.shift();this.startAnimation(t)}this._log("Animation complete")}}startAnimation(t){this.currentAnimation=t,this.currentAnimation.startTime=performance.now(),this.currentAnimation.startPosition=window.scrollY,this.isAnimating=!0,this._log(`Starting animation to ${t.targetPosition}px with ${t.easing} easing`)}scrollTo(t,e={}){return this._shouldUseSmooth()?new Promise((i=>{let s;if("number"==typeof t)s=t;else if(t instanceof HTMLElement){const i=t.getBoundingClientRect();s=window.scrollY+i.top-(e.offset??this.config.autoScrollOffset)}else{if("string"!=typeof t)return this._log("Invalid target for scrollTo",t),void i(!1);{const n=document.querySelector(t);if(!n)return this._log(`Element not found: ${t}`),void i(!1);{const t=n.getBoundingClientRect();s=window.scrollY+t.top-(e.offset??this.config.autoScrollOffset)}}}const n={targetPosition:s,startPosition:window.scrollY,startTime:null,duration:e.duration??this.config.scrollToDuration,easing:e.easing??this.config.scrollToEasing,onComplete:()=>{"function"==typeof e.onComplete&&e.onComplete(),i(!0)}};this.isAnimating?e.immediate?(this.animations=[],this.isAnimating=!1,this.currentAnimation=null,this.startAnimation(n)):this.animations.push(n):this.startAnimation(n)})):this._nativeScrollTo(t,e)}_nativeScrollTo(t,e={}){return new Promise((i=>{let s;if("number"==typeof t)s=t;else if(t instanceof HTMLElement)s=t.getBoundingClientRect().top+window.scrollY-(e.offset??this.config.autoScrollOffset);else{if("string"!=typeof t)return this._log("Invalid target for scrollTo",t),void i(!1);{const n=document.querySelector(t);if(!n)return this._log(`Element not found: ${t}`),void i(!1);s=n.getBoundingClientRect().top+window.scrollY-(e.offset??this.config.autoScrollOffset)}}const n=!this.prefersReducedMotion&&this.config.respectReducedMotion?"smooth":"auto";window.scrollTo({top:s,behavior:n}),setTimeout((()=>{"function"==typeof e.onComplete&&e.onComplete(),i(!0)}),"smooth"===n?500:100)}))}handleResize(){this.setupScrollStructure()}handleVisibilityChange(){"visible"===document.visibilityState?this.start():this.stop()}start(){!this.isRunning&&this._shouldUseSmooth()&&(this.isRunning=!0,this.lastTime=performance.now(),this.currentScroll=window.scrollY,this.targetScroll=window.scrollY,null===this.animationFrameId&&(this.animationFrameId=requestAnimationFrame(this.updateScroll)),this._log("Smooth scrolling started"))}stop(){this.isRunning=!1,null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this._log("Smooth scrolling stopped")}updateConfig(t={}){Object.assign(this.config,t);const e=this._shouldUseSmooth();e&&!this.isRunning?this.init():!e&&this.isRunning&&(this.destroy(),this._setupFallback()),this._log("Configuration updated",this.config)}addEasing(t,e){"function"==typeof e?(this.easings[t]=e,this._log(`Added easing function: ${t}`)):this._log(`Invalid easing function for ${t}`)}destroy(){this.stop(),window.removeEventListener("resize",this.handleResize),window.removeEventListener("scroll",this.handleScroll),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.wrapperElement&&this.scrollElement&&(this.wrapperElement.parentNode.insertBefore(this.scrollElement,this.wrapperElement),this.wrapperElement.parentNode.removeChild(this.wrapperElement)),this.scrollElement&&(this.scrollElement.style.position="",this.scrollElement.style.top="",this.scrollElement.style.left="",this.scrollElement.style.width="",this.scrollElement.style.zIndex="",this.scrollElement.style.transform="",this.scrollElement.style.willChange="",this.scrollElement.removeAttribute("aria-live")),this._log("Smooth scrolling destroyed and cleaned up")}init(){this.scrollElement?(this.setupScrollStructure(),window.addEventListener("resize",this.handleResize,{passive:!0}),window.addEventListener("scroll",this.handleScroll,{passive:!0}),document.addEventListener("visibilitychange",this.handleVisibilityChange),"undefined"!=typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.scrollElement)),this.start(),this._log("Smooth scroll initialized with these settings:",this.config)):this._log("No scroll element found. Initialization aborted.")}}